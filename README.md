# Dating Project (Draft)

Это драфт приложения для знакомств. Включает в себя модель для управления участниками и базовую реализацию сервисов.

## Используемые технологии

- **Python 3.12**: Язык программирования проекта.
- **SQLite**: Используется в качестве базы данных для разработки.
- **SQLAlchemy**: Используется как ORM для взаимодействия с базой данных.
- **Pydantic**: Применяется для валидации данных и управления входными данными.
- **Alembic**: Используется для управления миграциями базы данных.
- **python-dotenv**: Упрощает работу с переменными окружения.


 
## Модель участников

Участник имеет следующие поля:
- **ID**: Уникальный идентификатор пользователя.
- **Аватар**: URL аватара пользователя (опционально).
- **Пол**: Может быть 'male' или 'female'.
- **Имя**: Имя пользователя.
- **Фамилия**: Фамилия пользователя.
- **Почта**: Уникальный адрес электронной почты.

Добавлено поле **is_active** для поддержки "soft delete".

Дата создания и изменения пользователя на данный момент не реализована для простоты начальной реализации.

## UserService

Реализован черновик сервиса пользователей `UserService`, который включает:
- Метод **email_exists** для проверки уникальности электронной почты.

## Pydantic схемы

В проекте используются Pydantic схемы для валидации и управления данными:
- **UserCreate**: Для валидации входных данных при создании пользователей.
- **UserResponse**: Для формирования ответов с данными пользователя.


## Структура проекта

```
dating/
├── alembic/             # Скрипты миграций базы данных
├── alembic.ini          # Конфигурационный файл Alembic
├── create_db_once.py    # Скрипт для инициализации базы данных
├── README.md            # Документация проекта
├── requirements.txt     # Зависимости проекта
└── src/
    ├── config/         
    │   ├── database.py  # Конфигурация соединения с БД
    │   ├── logging.py   # Настройки логирования
    │   └── settings.py  # Общие настройки приложения
    ├── models/          # ORM-модели
    │   └── user.py      # Модель пользователя
    ├── schemas/         # Pydantic схемы
    │   └── user.py      # Схемы для пользователей
    └── services/        
        └── user_service.py  # Логика работы с пользователями
```

## Установка

Рекомендуется использовать виртуальное окружение для изоляции зависимостей вашего проекта.

1. Склонируйте репозиторий:
    ```sh
    git clone https://github.com/sergei-kruchinin/dating.git
    cd dating
    ```

2. Создайте виртуальное окружение:
   ```bash
   python -m venv .venv
   ```

3. Активируйте виртуальное окружение:
   - На MacOS/Linux:
    ```bash
    source .venv/bin/activate
    ```
   - На Windows:
    ```bash
    .venv\Scripts\activate
    ```

4. Убедитесь, что виртуальное окружение активировано, это можно определить по префиксу `(.venv)` в командной строке.

5. Установите все необходимые зависимости:
   ```bash
   pip install -r requirements.txt
   ```

6. Создайте `.env` файл в корневом каталоге проекта. В этом файле вы можете определить переменные окружения:
   * DATABASE_URL URL для подключения БД. Включая драйвер БД
   * SECRET_KEY=your_secret_key_here
   * AVATAR_DIR=directory_for_avatars 
   
   Пример файла .env:
   ```dotenv
   # Пример содержимого .env файла
   DATABASE_URL=sqlite+aiosqlite:////tmp/database.db
   SECRET_KEY=your_secret_key_here
   AVATAR_DIR=/tmp/avatars
   ```

7. Не забудьте поменять значение в alembic.ini (для приведенного примера)
   ```
   sqlalchemy.url = sqlite:////tmp/database.db
   ```

   ### Примечания

   - Если `.env` не будет создан, будут использоваться значения по умолчанию из src/config/settings.py, что не вполне безопасно. 


8. Запустите скрипт для инициализации базы данных:
   ```bash
   python create_db_once.py
   ```

## Дополнительные инструкции

### Использование Alembic

Проект использует Alembic для управления миграциями базы данных. Миграции уже существуют в папке `alembic/versions`.


### Применение существующих миграций

Чтобы обновить базу данных до последней версии схемы, выполните следующую команду:
```bash
alembic upgrade head
```

### Создание новой миграции

Если вы вносите изменения в модели и хотите зафиксировать их, создайте новую миграцию:
```bash
alembic revision --autogenerate -m "Описание изменений"
```

### Откат миграции

Для отката последней миграции:
```bash
alembic downgrade -1
```


## Примечания

Этот проект является черновиком и может быть расширен для добавления дополнительных возможностей и улучшения существующих функций.  